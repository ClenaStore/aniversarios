<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Painel de Anivers√°rios</title>
<style>
:root{--bg:#0b1220;--panel:#111827;--line:#1f2937;--text:#e5e7eb;--muted:#9ca3af;--accent:#60a5fa;--ok:#22c55e}
*{box-sizing:border-box}html,body{margin:0}
body{font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;background:linear-gradient(180deg,#0b1220,#060a14);color:var(--text)}
.container{max-width:1000px;margin:24px auto;padding:0 16px}
.card{background:rgba(17,24,39,.9);border:1px solid var(--line);border-radius:16px;padding:16px}
.grid{display:grid;gap:12px}.cols-2{grid-template-columns:2fr 1fr}
label{display:block;font-size:.85rem;color:var(--muted);margin-bottom:6px}
input,button{width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--line);background:#0c1322;color:var(--text)}
button{background:var(--ok);color:#052012;font-weight:700;cursor:pointer}
table{width:100%;border-collapse:separate;border-spacing:0 8px;margin-top:10px}
thead th{color:var(--muted);text-align:left;padding:8px 10px}
tbody td{padding:10px;border:1px solid var(--line);background:#0c1322}
tbody td:first-child{border-radius:12px 0 0 12px}tbody td:last-child{border-radius:0 12px 12px 0}
.badge{display:inline-block;padding:4px 10px;border:1px solid var(--line);border-radius:999px;color:var(--muted);font-size:.8rem}
.small{font-size:.85rem;color:var(--muted)}
</style>
</head>
<body>
<div class="container">
  <h1 style="margin:0 0 8px 0;font-size:1.5rem">üéâ Painel de Anivers√°rios</h1>

  <!-- Endpoint do Apps Script oculto/imut√°vel (fixado no JS) -->
  <section class="card">
    <div class="grid cols-2">
      <div>
        <label>Filtro de empresa (opcional)</label>
        <input id="EMPRESA" placeholder="MERCATTO DELICIA">
      </div>
      <div>
        <label>Janela de dias</label>
        <input id="DIAS" type="number" min="1" max="365" value="20">
      </div>
    </div>
    <div style="display:flex;gap:10px;margin-top:12px">
      <button onclick="load()">Carregar</button>
      <span id="status" class="badge">aguardando‚Ä¶</span>
    </div>
  </section>

  <section class="card" style="margin-top:14px">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h2 style="margin:0;font-size:1.1rem">Pr√≥ximos Anivers√°rios</h2>
      <span id="kpi" class="badge">‚Äî</span>
    </div>
    <div style="overflow:auto">
      <table>
        <thead><tr>
          <th>Nome</th><th>Empresa</th><th>Anivers√°rio</th><th>Faltam (dias)</th>
        </tr></thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
    <div id="msg" class="small" style="margin-top:8px"></div>
  </section>
</div>

<script>
/* ===== URL FIXA (oculta e bloqueada para edi√ß√£o) ===== */
const GAS_URL_FIXED = 'https://script.google.com/macros/s/AKfycbwHwNixmjn9pB_pKIBuONuHpssEfs5mza-sT9CQDaIZP2vlLNw269pbdNPAyZoPzVkcYA/exec';

const $ = id => document.getElementById(id);
function esc(s){return (s||'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[m]))}
function setStatus(t){ $('status').textContent = t; }

async function load(){
  const empresa = $('EMPRESA').value.trim();
  const dias = Number($('DIAS').value || 20);

  setStatus('carregando‚Ä¶');
  $('msg').textContent = '';

  const qs = new URLSearchParams({ action:'list', days:String(dias) });
  if (empresa) qs.append('empresa', empresa);

  try{
    const r = await fetch(`${GAS_URL_FIXED}?${qs.toString()}`);
    if (!r.ok) throw new Error('HTTP '+r.status);
    const data = await r.json();
    render(data.data || []);
    setStatus('pronto');
  }catch(e){
    setStatus('erro');
    $('msg').textContent = 'Falha ao carregar: ' + e.message;
  }
}

function render(rows){
  const tb = $('tbody'); tb.innerHTML='';
  $('kpi').textContent = `${rows.length} registro(s)`;
  rows.forEach(item=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${esc(item.nome)}</td>
      <td>${esc(item.empresa||'')}</td>
      <td>${esc(item.aniversario)}</td>
      <td>${item.dias}</td>`;
    tb.appendChild(tr);
  });
}
</script>
</body>
</html>
