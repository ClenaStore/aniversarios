<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <title>Bazar • Produtos Usados</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body{font-family:Arial, sans-serif;background:#f8fafc;margin:0;color:#111}
    header{padding:16px;background:#16a34a;color:#fff;text-align:center}

    /* Banner */
    .banner{position:relative;height:220px;overflow:hidden}
    .slide{position:absolute;inset:0;opacity:0;transition:opacity 1s ease;background-position:center;background-size:cover}
    .slide.active{opacity:1}
    .banner-dots{position:absolute;bottom:12px;left:0;right:0;display:flex;gap:6px;justify-content:center}
    .dot{width:10px;height:10px;border-radius:50%;background:rgba(255,255,255,.5);cursor:pointer}
    .dot.active{background:#fff}

    /* Toolbar */
    .toolbar{display:flex;gap:10px;align-items:center;padding:10px 16px;background:#fff;border-bottom:1px solid #e5e7eb}
    .search{flex:1;padding:8px;border:1px solid #ccc;border-radius:6px}
    .filter{padding:8px;border:1px solid #ccc;border-radius:6px}

    /* Grid */
    .grid{display:grid;gap:12px;padding:16px;
          grid-template-columns:repeat(2,1fr);}
    @media(min-width:900px){.grid{grid-template-columns:repeat(6,1fr);}}
    .card{background:#fff;border:1px solid #e5e7eb;border-radius:10px;overflow:hidden;cursor:pointer;transition:.2s;display:flex;flex-direction:column}
    .card:hover{transform:scale(1.02)}
    .card img{width:100%;height:120px;object-fit:cover}
    .card .info{padding:8px;flex:1}
    .card h3{margin:0;font-size:14px}
    .card .price{color:#16a34a;font-weight:bold;margin:4px 0}
    .flag{font-size:11px;color:#555;border:1px dashed #ccc;border-radius:999px;padding:2px 6px;display:inline-block;margin-top:4px}

    /* Modal */
    .modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);align-items:center;justify-content:center;z-index:100}
    .modal.active{display:flex}
    .modal-content{background:#fff;padding:20px;border-radius:12px;max-width:400px;width:90%;text-align:center;position:relative}
    .modal-content img{width:100%;border-radius:8px;margin-bottom:12px}
    .close{position:absolute;top:10px;right:12px;font-size:20px;cursor:pointer}
    .btn{background:#16a34a;color:#fff;padding:10px 14px;border:none;border-radius:8px;cursor:pointer;text-decoration:none;display:inline-block;margin-top:10px}
  </style>
</head>
<body>
  <header>
    <h1>Bazar de Usados</h1>
  </header>

  <!-- Banner -->
  <section class="banner" id="banner">
    <div class="slide active" style="background-image:url('https://images.unsplash.com/photo-1483985988355-763728e1935b?q=80&w=1600&auto=format&fit=crop');"></div>
    <div class="slide" style="background-image:url('https://images.unsplash.com/photo-1520975622034-763f2f2997c7?q=80&w=1600&auto=format&fit=crop');"></div>
    <div class="slide" style="background-image:url('https://images.unsplash.com/photo-1517630800677-932d836ab680?q=80&w=1600&auto=format&fit=crop');"></div>
    <div class="banner-dots">
      <div class="dot active"></div>
      <div class="dot"></div>
      <div class="dot"></div>
    </div>
  </section>

  <!-- Barra de pesquisa + filtro -->
  <div class="toolbar">
    <input id="search" class="search" type="search" placeholder="Buscar produto...">
    <select id="filter" class="filter">
      <option value="Todos">Todos</option>
      <option value="Novo">Novo</option>
      <option value="Usado">Usado</option>
    </select>
  </div>

  <main>
    <div id="grid" class="grid"></div>
  </main>

  <!-- Modal -->
  <div id="modal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">&times;</span>
      <img id="mFoto" src="">
      <h2 id="mNome"></h2>
      <div id="mPreco"></div>
      <p id="mDesc"></p>
      <span id="mFlag" class="flag"></span>
      <br>
      <a id="mWhats" class="btn" target="_blank">Falar no WhatsApp</a>
    </div>
  </div>

  <script>
    const GRID = document.getElementById("grid");
    const MODAL = document.getElementById("modal");
    const API_URL = "https://script.google.com/macros/s/AKfycbwCIHLFAXNhuR0wSHoJLMh-YX3USqBEJjagGLZgoFyXR6gsEGqXyedn1z6J3gc1DCHuaA/exec"; // link do GAS
    let produtos = [];

    // Banner rotativo
    (function(){
      const slides = [...document.querySelectorAll(".slide")];
      const dots = [...document.querySelectorAll(".dot")];
      let i=0;
      setInterval(()=>{
        slides[i].classList.remove("active");
        dots[i].classList.remove("active");
        i = (i+1)%slides.length;
        slides[i].classList.add("active");
        dots[i].classList.add("active");
      },4000);
    })();

    // Buscar dados da planilha
    fetch(API_URL)
      .then(r=>r.json())
      .then(data=>{
        produtos = data;
        render(produtos);
      });

    function render(list){
      GRID.innerHTML = "";
      list.forEach((p)=>{
        const card = document.createElement("div");
        card.className="card";
        card.innerHTML=`
          <img src="${p.foto}" alt="${p.nome}">
          <div class="info">
            <h3>${p.nome}</h3>
            <div class="price">R$ ${Number(p.preco).toFixed(2)}</div>
            <span class="flag">${p.flag}</span>
          </div>`;
        card.onclick = ()=> openModal(p);
        GRID.appendChild(card);
      });
    }

    function openModal(p){
      document.getElementById("mFoto").src=p.foto;
      document.getElementById("mNome").textContent=p.nome;
      document.getElementById("mPreco").textContent="R$ "+Number(p.preco).toFixed(2);
      document.getElementById("mDesc").textContent=p.descricao;
      document.getElementById("mFlag").textContent=p.flag;
      const msg=`Olá! Tenho interesse neste produto:\n\n${p.nome}\nValor: R$ ${Number(p.preco).toFixed(2)}\n${p.descricao}`;
      document.getElementById("mWhats").href=`https://wa.me/${p.whatsapp}?text=${encodeURIComponent(msg)}`;
      MODAL.classList.add("active");
    }
    function closeModal(){ MODAL.classList.remove("active"); }

    // Filtro de pesquisa + flag
    document.getElementById("search").addEventListener("input", applyFilters);
    document.getElementById("filter").addEventListener("change", applyFilters);

    function applyFilters(){
      const q = document.getElementById("search").value.toLowerCase();
      const f = document.getElementById("filter").value;
      const filtered = produtos.filter(p=>{
        const matchesSearch = p.nome.toLowerCase().includes(q) || p.descricao.toLowerCase().includes(q);
        const matchesFlag = (f==="Todos") || (p.flag===f);
        return matchesSearch && matchesFlag;
      });
      render(filtered);
    }
  </script>
</body>
</html>
